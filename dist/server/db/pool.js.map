{"version":3,"sources":["../../../src/server/db/pool.js"],"names":["process","env","DB_URL","Error","params","parse","auth","split","username","password","options","host","hostname","port","database","pathname","max","DB_MAX_CONNECTIONS","user","ssl","pool","on","console","log","err","message","stack"],"mappings":";;;;;;;;AAAA;;AACA;;;;;;AAEA,IAAI,CAACA,QAAQC,GAAR,CAAYC,MAAjB,EAAyB,MAAM,IAAIC,KAAJ,CAAU,yCAAV,CAAN;;AAEzB,IAAMC,SAAS,cAAIC,KAAJ,CAAUL,QAAQC,GAAR,CAAYC,MAAtB,CAAf;;yBAC6BE,OAAOE,IAAP,CAAYC,KAAZ,CAAkB,GAAlB,C;;IAAtBC,Q;IAAUC,Q;;AAEjB,IAAMC,UAAU;AACdC,QAAMP,OAAOQ,QADC;AAEdC,QAAMT,OAAOS,IAFC;AAGdC,YAAUV,OAAOW,QAAP,CAAgBR,KAAhB,CAAsB,GAAtB,EAA2B,CAA3B,CAHI;AAIdS,OAAKhB,QAAQC,GAAR,CAAYgB,kBAAZ,IAAkC;AAJzB,CAAhB;;AAOA,IAAIT,QAAJ,EAAcE,QAAQQ,IAAR,GAAeV,QAAf;AACd,IAAIC,QAAJ,EAAcC,QAAQD,QAAR,GAAmBA,QAAnB;AACdC,QAAQS,GAAR,GAAeT,QAAQC,IAAR,KAAiB,WAAhC;;AAEA,IAAMS,OAAO,aAASV,OAAT,CAAb;;AAEAU,KAAKC,EAAL,CAAQ,OAAR,EAAiB;AAAA;AACf;AACAC,YAAQC,GAAR,CAAY,oBAAZ,EAAkCC,IAAIC,OAAtC,EAA+CD,IAAIE,KAAnD;AAFe;AAAA,CAAjB;;kBAIeN,I","file":"pool.js","sourcesContent":["import { Pool } from 'pg';\nimport url from 'url';\n\nif (!process.env.DB_URL) throw new Error('Environment variable DB_URL must be set');\n\nconst params = url.parse(process.env.DB_URL);\nconst [username, password] = params.auth.split(':');\n\nconst options = {\n  host: params.hostname,\n  port: params.port,\n  database: params.pathname.split('/')[1],\n  max: process.env.DB_MAX_CONNECTIONS || 4,\n};\n\nif (username) options.user = username;\nif (password) options.password = password;\noptions.ssl = (options.host !== 'localhost');\n\nconst pool = new Pool(options);\n\npool.on('error', err =>\n  // eslint-disable-next-line no-console\n  console.log('Idle client error:', err.message, err.stack));\n\nexport default pool;\n"]}